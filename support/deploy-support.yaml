---
- name: Register with subscription-manager
  shell: 'subscription-manager register --username {{ username }} --password {{ password }}'

- name: Attach pool ID
  shell: 'subscription-manager attach --pool=$(subscription-manager list --available --all --matches="Employee" --pool-only | head -n1)'

- name: Install support services
  package:
    name:
    - bind
    - chrony
    - dhcpd
    - haproxy
    - httpd
    state: present

- name: Copy config files 
  copy: 
    src: {{ item.src }}
    dest: {{ item.dest }}
    owner: root
    group: root
    mode: '0644'
    backup: yes
  with_items:
    - { src: 'named/etc/named.conf', dest: '/etc/named.conf' }
    - { src: 'named/var/named/155.168.192.in-addr.arpa', dest: '/var/named/155.168.192.in-addr.arpa' }
    - { src: 'named/var/named/kahvi.online.zone', dest: '/var/named/kahvi.online.zone' }
    - { src: 'chronyd/etc/chrony.conf', dest: '/etc/chrony.conf' }
    - { src: 'chronyd/etc/chrony.conf', dest: '/etc/chrony.conf' }
    - { src: 'dhcpd/etc/dhcpd/dhcpd.conf', dest: '/etc/dhcpd/dhcpd.conf' }
    - { src: 'haproxy/etc/haproxy.cfg', dest: '/etc/haproxy/haproxy.cfg' }
    - { src: 'httpd/etc/httpd/conf/httpd.conf', dest: '/etc/httpd/conf/httpd.con' }

- name: Enable services
  service: "{{ item }}"
  enabled: true
  state: restarted
  with_items:
  - bind
  - chrony
  - dhcpd
  - haproxy
  - httpd
...
